<!DOCTYPE html>
<html lang="sv" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <th:block th:include="fragments/header :: header"></th:block>
    <title>Boka möten - Scoutmöten</title>
    <script th:src="@{/js/jquery-3.6.0.min.js}"></script>
    <script th:inline="javascript"> var path = /*[[@{/}]]*/ ''; </script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var attendeeid = /*[[${attendee.id}]]*/ null;
        var signupurl = /*[[@{'/bookmeeting/signup/'}]]*/ null;
        var declineurl = /*[[@{'/bookmeeting/decline/'}]]*/ null;

        $(document).ready(function () {
            $('input:radio').change(function () {
                if ($(this).prop("checked")) {
                    //do the stuff that you would do when 'checked'
                    let idvalue = $(this).prop('id');
                    let meetingid = idvalue.substring(0,idvalue.indexOf("_"));
                    if(idvalue.includes('yes')){
                        signUp(meetingid);
                    }else{
                        decline(meetingid);
                    }
                    return;
                }
                //Here do the stuff you want to do when 'unchecked'
                alert('varför hamnar vi här');
            });
        });

        function signUp(meetingId) {
            jQuery.ajax({
                url: signupurl + attendeeid + '/to/' + meetingId,
                type: 'PUT',

                success: function (data) {
                    //You handle the response here like displaying in required div etc.
                    //markera och ge en tumme upp?
                },
                error: function (errorData) {
                    alert("Det gick inte att anmäla att du kommer till mötet");
                }
            });
        }

        function decline(meetingId) {
            jQuery.ajax({
                url: declineurl + attendeeid + '/to/' + meetingId,
                type: 'PUT',

                success: function (data) {
                    //You handle the response here like displaying in required div etc.
                    //markera och ge en tumme upp?
                },
                error: function (errorData) {
                    alert("Det gick inte att anmäla att du kommer till mötet");
                }
            });
        }

        function reloadPage() {
            window.location = window.location.pathname;
        }

        /*]]>*/



    </script>

</head>
<body>

<div class="nav-box">
<span class="toolbar">
</span>
    <h1>Kommer eller kommer inte - det är frågan!</h1>
</div>
<div class="form-box">
    <h2 th:text="${attendee.name}"></h2>
    <p th:text="${'Avdelning ' + attendee.department.name}"></p>
    Det är kul att vara på scouterna! Det är alltid bra att veta om du/din scout kommer så svara nedan.
    Du kan komma tillbaka till sidan och ändra dig. Tänk på att vissa möten har en sista anmälningsdag och att alla
    möten kanske inte syns i den här listan.

    <div class="notepad">
        <ul class="list">
            <li th:each="meeting: ${meetings}">
                <a th:href="@{'/bookmeeting/meetinginfo/' + ${meeting.id}}"
                   th:text="${meeting.startDate + ' ' + meeting.title}"></a>
                <span th:if="${meeting.lastBookDate != null && meeting.lastBookDate."
                <span class="radio-toolbar">
                    <input type="radio" th:id="${meeting.id + '_yes'}" th:name="${meeting.id}" th:checked="${#lists.contains(acceptedMeetings, meeting.id.toString())}" value="Kommer">
                    <label th:for="${meeting.id + '_yes'}">Kommer!</label>
                    <input type="radio" th:id="${meeting.id + '_no'}" th:name="${meeting.id}" th:checked="${#lists.contains(declinedMeetings, meeting.id.toString())}" value="Kommer inte">
                    <label th:for="${meeting.id + '_no'}">Kommer ej</label>
                </span>
            </li>
        </ul>
    </div>
    <p>
    </p>
</div>
</body>
</html>